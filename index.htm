<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>Âú®Á∫ø TXT ‚áÑ M3U ËΩ¨Êç¢Â∑•ÂÖ∑</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        :root {
            --primary: #4361ee;
            --primary-hover: #3a56d4;
            --bg: #f8f9fd;
            --card-bg: #ffffff;
            --text-main: #2b2d42;
            --text-muted: #6c757d;
            --border: #e0e4e8;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --font: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text-main);
            line-height: 1.6;
            padding: 20px 10px;
        }

        .header-banner {
            max-width: 900px;
            margin: 0 auto 30px;
            text-align: center;
        }

        .header-banner h1 {
            font-size: 24px;
            color: var(--primary);
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .section-title {
            display: flex;
            align-items: center;
            font-size: 15px;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-title::before {
            content: "";
            display: inline-block;
            width: 4px;
            height: 16px;
            background: var(--primary);
            margin-right: 8px;
            border-radius: 2px;
        }

        textarea {
            width: 100%;
            min-height: 220px;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: 'Fira Code', 'Cascadia Code', Consolas, monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
            transition: all 0.2s;
            background: #fafafa;
            color: #444;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: #fff;
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
        }

        .note {
            color: var(--text-muted);
            font-size: 13px;
            margin: 8px 0 20px;
            display: flex;
            align-items: center;
        }

        .note::before {
            content: "üí°";
            margin-right: 5px;
        }

        .controls-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f1f3f9;
            border-radius: var(--radius);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border);
            background: white;
            color: var(--text-main);
            text-decoration: none;
        }

        .btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            color: white;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        /* Switch Styling */
        .switch-wrap {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px; width: 16px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(18px);
        }

        /* Result Card Animation */
        #resultCard {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px dashed var(--border);
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none; }

        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: #333;
            color: #fff;
            border-radius: 50px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 9999;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            font-size: 13px;
        }

        @media (max-width: 600px) {
            .controls-row {
                flex-direction: column;
                align-items: flex-start;
            }
            .button-group {
                width: 100%;
            }
            .btn {
                flex: 1;
            }
        }
    </style>
</head>

<body>
    <div class="header-banner">
        <h1>Âú®Á∫ø TXT ‚áÑ M3U ËΩ¨Êç¢Â∑•ÂÖ∑</h1>
    </div>

    <div class="container">
        <div class="section-title">ËæìÂÖ• TXT / M3U ÂÜÖÂÆπ</div>
        <textarea id="inputArea" placeholder="ËØ∑Âú®Ê≠§Â§ÑÁ≤òË¥¥ÂÜÖÂÆπÔºåÊàñÂ∞ÜÊñá‰ª∂ÊãñÊãΩËá≥Ê≠§Â§Ñ..."></textarea>
        <div class="note">ÊîØÊåÅÊãñÊîæÊñá‰ª∂ÔºåËá™Âä®ËØÜÂà´Ê†ºÂºèÂπ∂ËΩ¨Êç¢</div>
        
        <div class="controls-row">
            <label class="switch-wrap">
                <span class="switch">
                    <input type="checkbox" id="autoGroup">
                    <span class="slider"></span>
                </span>
                <span>Êô∫ËÉΩËá™Âä®ÂàÜÁªÑ (CCTV/Âç´ËßÜ/Ê∏ØÂè∞)</span>
            </label>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="convert('txt')">ËΩ¨‰∏∫ TXT</button>
                <button class="btn btn-primary" onclick="convert('m3u')">ËΩ¨‰∏∫ M3U</button>
                <button class="btn" onclick="clearInput()">Ê∏ÖÁ©∫</button>
            </div>
        </div>

        <div id="resultCard" class="hidden">
            <div class="section-title">ËΩ¨Êç¢ÁªìÊûú</div>
            <textarea id="resultArea" readonly></textarea>
            <div class="button-group" style="margin-top: 15px;">
                <button class="btn btn-outline" onclick="copyResult()">Â§çÂà∂ÁªìÊûú</button>
                <a id="downloadBtn" class="btn btn-outline" download>‰øùÂ≠òÂà∞Êú¨Âú∞Êñá‰ª∂</a>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>¬© 2025 backin - ÊûÅÁÆÄÊµÅÂ™í‰ΩìÊ†ºÂºèËΩ¨Êç¢Â∑•ÂÖ∑</p>
    </div>

    <div id="toast"></div>

    <script>
        /* ---------- ‰∏öÂä°ÈÄªËæë (‰øùÊåÅÂéüÊ†∑) ---------- */
        const toast = document.getElementById('toast');
        function showToast(msg) {
            toast.textContent = msg;
            toast.style.opacity = 1;
            toast.style.bottom = '40px';
            setTimeout(() => {
                toast.style.opacity = 0;
                toast.style.bottom = '30px';
            }, 2500);
        }

        const hkTwKw = ['Â§©Êò†', 'Áæé‰∫ö', 'Êæ≥ËßÜ', 'VIUTV', 'Êó†Á∫øÊñ∞Èóª', 'HOY', 'NOW', 'Âè∞Êπæ', 'È¶ôÊ∏Ø', 'Âá§Âá∞', 'Áø°Áø†', 'ÊòéÁè†', 'TVB', 'ANIMAX', 'AXN', 'Arirang', 'BBC', 'Bloomberg', 'CARTOONITO', 'CBeebies', 'CINEMAX', 'CNBC', 'CNN', 'CNÂç°ÈÄö', 'CatchPlay', 'CinemaWorld', 'DAZN', 'DMAX', 'DWTV', 'Discovery', 'DreamWorks', 'ETtoday', 'EVE', 'FRANCE', 'FashionTV', 'Food', 'Global', 'HBO', 'HITS', 'INULTRA', 'JET', 'LOVE_NATURE', 'LUXE', 'Lifetime', 'MOMO', 'MTV', 'NHK', 'Nick', 'Pet_Club_TV', 'ROCK', 'TLC', 'TV5', 'TVBS', 'TaiwanPlus', 'TechStorm', 'Travel', 'Warner_TV', 'ZÈ¢ëÈÅì', 'amc', 'rollor', 'tvN', '‰∏âÂú£ÁîµËßÜ', '‰∏âÁ´ã', '‰∏úÊ£Æ', '‰∏úÈ£éÂç´ËßÜ', '‰∏≠Â§©', '‰∏≠ËßÜ', '‰πêËßÜÂè∞', '‰∫öÊ¥≤', '‰∫∫Èó¥', '‰ΩõÂç´', 'ÂÖ´Â§ß', 'ÂÖ¨ÂÖ±ÁîµËßÜ', 'ÂÖ¨ËßÜ', 'ÂÜ†ÂÜõ', 'Âä®Áâ©ÊòüÁêÉ', 'ÂçÅÊñπÊ≥ïÁïå', 'ÂçäÂ≤õ', 'ÂçéËâ∫', 'ÂçéËóè', 'ÂçéËßÜ', 'ÂçöÊñØ', 'ÂéÜÂè≤', 'Âéü‰ΩèÊ∞ë', 'ÂèåÂ≠êÂç´ËßÜ', 'Âè§ÂÖ∏Èü≥‰πê', 'Âè∞Êπæ', 'Âè∞ËßÜ', 'ÂõΩÂÖ¥', 'Â£πÁîµËßÜ', 'Â§ßÁà±', 'Â§©Áæé‰∏ΩÁîµËßÜ', 'Â§©ËâØÁªºÂêà', 'Â•ΩÊ∂àÊÅØ', 'Â•ΩËé±Âùû', 'ÂÆ¢ÂÆ∂ÁîµËßÜ', 'ÂØåÁ´ã', 'Â∞ºÂÖãÂÑøÁ´•', 'Â±ÖÂÆ∂', 'Âπ¥‰ª£', 'Âπ∏Á¶èÁ©∫Èó¥', 'Êñ∞Â§©Âú∞Ê∞ë‰øó', 'Êô∫Êûó‰ΩìËÇ≤', 'Ê¢ÖËø™Â•áËâ∫ÊúØ', 'Ê¨ßÊ¥≤', 'Ê≠£Âæ∑', 'Ê∞ëËßÜ', 'Ê≥ïÂõΩTV5', 'Áà±Â∞îËææ', 'ÁãºË∞∑ËÇ≤‰πê', 'ÁéØÂÆá', 'ÁîüÂëΩ', 'Áï™ËñØ', 'Á∫¨Êù•', 'ÁΩ™Ê°à', 'ËØöÂøÉÁîµËßÜ', 'Ë∂ÖËßÜ', 'ËææÊñáË•ø', 'ËøêÈÄöË¥¢Áªè', 'ÈïúÁîµËßÜ', 'ÈúπÈõ≥', 'ÈùñÂ§©', 'ÈùñÊ¥ãÂç°', 'ÈùûÂá°', 'Èü©ÂõΩÂ®±‰πê', 'È´òÁÇπ', 'ÈæôÁ••', 'Ê∏ØÂè∞ÁîµËßÜ', 'RTHK'];

        function getGroup(name) {
            const n = name.toUpperCase();
            if (/CCTV|CETV|‰∏≠Â§Æ/i.test(n)) return 'Â§ÆËßÜÈ¢ëÈÅì';
            if (/Âç´ËßÜ/.test(name) && !/Âá§Âá∞Âç´ËßÜ/i.test(name)) return 'Âç´ËßÜÈ¢ëÈÅì';
            for (const kw of hkTwKw)
                if (n.includes(kw.toUpperCase())) return 'Ê∏ØÂè∞È¢ëÈÅì';
            return 'Âú∞ÊñπÈ¢ëÈÅì';
        }

        function cctvSort(a, b) {
            const clean = s => s.toUpperCase().replace(/CETV|‰∏≠Â§Æ/gi, 'CCTV').replace(/[^0-9+]/g, '').replace(/^CCTV/, '');
            const na = clean(a.name), nb = clean(b.name);
            if (na === '') return 1;
            if (nb === '') return -1;
            return parseFloat(na.replace('+', '.5')) - parseFloat(nb.replace('+', '.5')) || a.name.localeCompare(b.name, 'zh-CN');
        }

        function normalizeCCTV(name) {
            return name.replace(/(CETV|‰∏≠Â§Æ)/gi, 'CCTV').replace(/Âè∞/g, '').replace(/\s*[-‚Äì‚Äî]\s*/g, '').replace(/\s+/g, '').replace(/È´òÊ∏Ö|Ê†áÊ∏Ö|Ë∂ÖÊ∏Ö|HDR|HD|Áîª‰∏≠Áîª|ÂçïÈü≥ËΩ®|-CM-IPTV|-Tel/gi, '').replace(/È´òÊ∏ÖÁîµÂΩ±/gi, 'ÂΩ±Ëø∑ÁîµÂΩ±').replace(/CCTV5\+/gi, 'CCTV5+');
        }

        const stdMap = [
            [/^(?!.*Âçé‰∏Ω).*Áø°Áø†Âè∞/i, 'Áø°Áø†Âè∞'],
            [/Áø°Áø†Âè∞.*4k?/i, 'Áø°Áø†Âè∞'],
            [/Êó†Á∫øÊñ∞ÈóªÂè∞/i, 'Êó†Á∫øÊñ∞Èóª'],
            [/ViuTVSix/i, 'viutvsix'],
            [/^(?!.*Six).*ViuTV/i, 'viutv'],
            [/Âçé‰∏ΩÁø°Áø†Âè∞/i, 'Âçé‰∏ΩÁø°Áø†Âè∞'],
            [/TVB Plus/i, 'TVBPLUS'],
            [/Áæé‰∫öÁîµÂΩ±Âè∞/i, 'Áæé‰∫öÁîµÂΩ±Âè∞'],
            [/Â§©Êò†È¢ëÈÅì/i, 'Â§©Êò†È¢ëÈÅì'],
            [/Âá§Âá∞(?:Âç´ËßÜ)?ËµÑËÆØ/i, 'Âá§Âá∞Âç´ËßÜËµÑËÆØÂè∞'],
            [/Âá§Âá∞(?:Âç´ËßÜ)?‰∏≠Êñá/i, 'Âá§Âá∞Âç´ËßÜ‰∏≠ÊñáÂè∞'],
            [/Âá§Âá∞(?:Âç´ËßÜ)?È¶ôÊ∏Ø/i, 'Âá§Âá∞Âç´ËßÜÈ¶ôÊ∏ØÂè∞'],
        ];

        function unifyTvgName(raw) {
            for (const [re, fixed] of stdMap)
                if (re.test(raw)) return fixed;
            return raw;
        }

        function convert(type) {
            const src = document.getElementById('inputArea').value.trim();
            if (!src) { showToast('ËØ∑ËæìÂÖ•ÂÜÖÂÆπ'); return; }
            const autoGroup = document.getElementById('autoGroup').checked;
            let result = '', filename = '';
            const isM3U = src.split('\n').some(l => l.trim().startsWith('#EXTINF:'));

            if (type === 'txt') {
                if (isM3U) {
                    const channels = [];
                    let curName = '', curUrl = '', curGrp = '';
                    src.split('\n').forEach(line => {
                        const t = line.trim();
                        if (t.startsWith('#EXTINF:')) {
                            const mName = t.match(/,([^,]+)$/);
                            curName = mName ? mName[1].trim() : '';
                            const mGrp = t.match(/group-title="([^"]*)"/i);
                            curGrp = mGrp ? mGrp[1].trim() : (autoGroup ? '' : 'Êú™ÂàÜÁªÑ');
                            curUrl = '';
                        } else if (!t.startsWith('#') && t) {
                            curUrl = t;
                            if (curName && curUrl) channels.push({ name: curName, url: curUrl, group: curGrp });
                        }
                    });
                    if (autoGroup) {
                        const groups = { 'Â§ÆËßÜÈ¢ëÈÅì': [], 'Ê∏ØÂè∞È¢ëÈÅì': [], 'Âç´ËßÜÈ¢ëÈÅì': [], 'Âú∞ÊñπÈ¢ëÈÅì': [] };
                        channels.forEach(({ name, url }) => {
                            const grp = getGroup(name);
                            if (grp === 'Â§ÆËßÜÈ¢ëÈÅì') name = normalizeCCTV(name);
                            groups[grp].push({ name, url });
                        });
                        if (groups['Â§ÆËßÜÈ¢ëÈÅì']) groups['Â§ÆËßÜÈ¢ëÈÅì'].sort(cctvSort);
                        const ordered = [];
                        ['Â§ÆËßÜÈ¢ëÈÅì', 'Ê∏ØÂè∞È¢ëÈÅì', 'Âç´ËßÜÈ¢ëÈÅì', 'Âú∞ÊñπÈ¢ëÈÅì'].forEach(grp => {
                            if (!groups[grp] || groups[grp].length === 0) return;
                            if (ordered.length) ordered.push('');
                            ordered.push(`${grp},#genre#`);
                            groups[grp].forEach(({ name, url }) => ordered.push(`${name},${url}`));
                        });
                        result = ordered.join('\n');
                    } else {
                        const map = new Map();
                        channels.forEach(({ group, name, url }) => {
                            const g = group || 'Êú™ÂàÜÁªÑ';
                            if (!map.has(g)) map.set(g, []);
                            map.get(g).push({ name, url });
                        });
                        const ordered = [];
                        for (const [grp, arr] of map) {
                            if (ordered.length) ordered.push('');
                            ordered.push(`${grp},#genre#`);
                            arr.forEach(({ name, url }) => ordered.push(`${name},${url}`));
                        }
                        result = ordered.join('\n');
                    }
                } else {
                    if (!autoGroup) { result = src; } else {
                        const groups = { 'Â§ÆËßÜÈ¢ëÈÅì': [], 'Ê∏ØÂè∞È¢ëÈÅì': [], 'Âç´ËßÜÈ¢ëÈÅì': [], 'Âú∞ÊñπÈ¢ëÈÅì': [] };
                        src.split('\n').forEach(line => {
                            const l = line.trim();
                            if (!l || l.includes('#genre#')) return;
                            const idx = l.indexOf(',');
                            if (idx === -1) return;
                            let name = l.slice(0, idx).trim();
                            const url = l.slice(idx + 1).trim();
                            const grp = getGroup(name);
                            if (grp === 'Â§ÆËßÜÈ¢ëÈÅì') name = normalizeCCTV(name);
                            groups[grp].push({ name, url });
                        });
                        if (groups['Â§ÆËßÜÈ¢ëÈÅì']) groups['Â§ÆËßÜÈ¢ëÈÅì'].sort(cctvSort);
                        const ordered = [];
                        ['Â§ÆËßÜÈ¢ëÈÅì', 'Ê∏ØÂè∞È¢ëÈÅì', 'Âç´ËßÜÈ¢ëÈÅì', 'Âú∞ÊñπÈ¢ëÈÅì'].forEach(grp => {
                            if (!groups[grp] || groups[grp].length === 0) return;
                            if (ordered.length) ordered.push('');
                            ordered.push(`${grp},#genre#`);
                            groups[grp].forEach(({ name, url }) => ordered.push(`${name},${url}`));
                        });
                        result = ordered.join('\n');
                    }
                }
                filename = 'playlist.txt';
            } else {
                if (isM3U) {
                    if (!autoGroup) { result = src; } else {
                        const channels = [];
                        let curName = '', curUrl = '', curGrp = '', curLogo = '', curTvgName = '';
                        src.split('\n').forEach(line => {
                            const t = line.trim();
                            if (t.startsWith('#EXTINF:')) {
                                const mName = t.match(/,([^,]+)$/);
                                curName = mName ? mName[1].trim() : '';
                                const mGrp = t.match(/group-title="([^"]*)"/i);
                                curGrp = mGrp ? mGrp[1].trim() : '';
                                const mLogo = t.match(/tvg-logo="([^"]*)"/i);
                                curLogo = mLogo ? mLogo[1].trim() : '';
                                const mTvg = t.match(/tvg-name="([^"]*)"/i);
                                curTvgName = mTvg ? mTvg[1].trim() : '';
                                curUrl = '';
                            } else if (!t.startsWith('#') && t) {
                                curUrl = t;
                                if (curName && curUrl) {
                                    const grp = getGroup(curName);
                                    channels.push({ name: curName, url: curUrl, group: grp, logo: curLogo, tvgName: curTvgName || curName });
                                }
                            }
                        });
                        const groups = { 'Â§ÆËßÜÈ¢ëÈÅì': [], 'Ê∏ØÂè∞È¢ëÈÅì': [], 'Âç´ËßÜÈ¢ëÈÅì': [], 'Âú∞ÊñπÈ¢ëÈÅì': [] };
                        channels.forEach(ch => groups[ch.group].push(ch));
                        if (groups['Â§ÆËßÜÈ¢ëÈÅì']) groups['Â§ÆËßÜÈ¢ëÈÅì'].sort((a, b) => cctvSort(a, b));
                        result = '#EXTM3U url-tvg="https://gitee.com/taksssss/tv/raw/main/epg/112114.xml.gz"\n';
                        ['Â§ÆËßÜÈ¢ëÈÅì', 'Ê∏ØÂè∞È¢ëÈÅì', 'Âç´ËßÜÈ¢ëÈÅì', 'Âú∞ÊñπÈ¢ëÈÅì'].forEach(grp => {
                            groups[grp].forEach(({ name, url, tvgName, logo }) => {
                                const fixedName = unifyTvgName(name);
                                result += `#EXTINF:-1 tvg-name="${fixedName}" tvg-logo="https://11.112114.xyz/logo/${fixedName}.png" group-title="${grp}",${name}\n${url}\n`;
                            });
                        });
                    }
                } else {
                    const lines = src.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('//'));
                    const chArr = [];
                    let curGroup = 'Êó†ÂàÜÁªÑ';
                    lines.forEach(line => {
                        if (line.includes('#genre#')) {
                            curGroup = line.split(',')[0].trim();
                            return;
                        }
                        if (line.startsWith('#') || !line) return;
                        const idx = line.indexOf(',');
                        if (idx === -1) return;
                        let name = line.slice(0, idx).trim();
                        const url = line.slice(idx + 1).trim();
                        if (autoGroup) {
                            const grp = getGroup(name);
                            if (grp === 'Â§ÆËßÜÈ¢ëÈÅì') name = normalizeCCTV(name);
                            curGroup = grp;
                        }
                        chArr.push({ name, url, group: curGroup });
                    });
                    const groups = new Map();
                    chArr.forEach(({ name, url, group }) => {
                        if (!groups.has(group)) groups.set(group, []);
                        groups.get(group).push({ name, url });
                    });
                    result = '#EXTM3U url-tvg="https://live.fanmingming.cn/e.xml"\n';
                    groups.forEach((channels, grp) => {
                        if (grp === 'Â§ÆËßÜÈ¢ëÈÅì') channels.sort(cctvSort);
                        channels.forEach(({ name, url }) => {
                            const fixedName = unifyTvgName(name);
                            result += `#EXTINF:-1 tvg-name="${fixedName}" tvg-logo="https://11.112114.xyz/logo/${fixedName}.png" group-title="${grp}",${name}\n${url}\n`;
                        });
                    });
                }
                filename = 'playlist.m3u';
            }

            document.getElementById('resultArea').value = result;
            document.getElementById('resultCard').classList.remove('hidden');
            const blob = new Blob([result], { type: 'text/plain' });
            const dl = document.getElementById('downloadBtn');
            dl.href = URL.createObjectURL(blob);
            dl.download = filename;
            showToast('ËΩ¨Êç¢ÂÆåÊàê');
        }

        function clearInput() {
            document.getElementById('inputArea').value = '';
            document.getElementById('resultCard').classList.add('hidden');
            showToast('Â∑≤Ê∏ÖÁ©∫');
        }

        function copyResult() {
            const area = document.getElementById('resultArea');
            area.select();
            document.execCommand('copy');
            showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
        }

        const inputArea = document.getElementById('inputArea');
        inputArea.addEventListener('dragover', e => { e.preventDefault(); inputArea.style.borderColor = 'var(--primary)'; });
        inputArea.addEventListener('dragleave', e => { e.preventDefault(); inputArea.style.borderColor = 'var(--border)'; });
        inputArea.addEventListener('drop', e => {
            e.preventDefault();
            inputArea.style.borderColor = 'var(--border)';
            const file = e.dataTransfer.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = ev => {
                    inputArea.value = inputArea.value + (inputArea.value.endsWith('\n') || inputArea.value === '' ? '' : '\n') + ev.target.result;
                    showToast('Êñá‰ª∂Â∑≤Âä†ËΩΩ');
                };
                reader.readAsText(file);
            }
        });
    </script>
</body>
</html>
