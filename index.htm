<!DOCTYPE html>
<html version="4" lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TXTå’ŒM3Uåœ¨çº¿äº’è½¬æ ¼å¼</title>
  <meta name="description" content="ä¸€ä¸ªç®€å•çš„åœ¨çº¿TXTè½¬M3Uæ ¼å¼å·¥å…·ï¼Œçº¯å‰ç«¯å¤„ç†ï¼Œæ— éœ€ä¸Šä¼ txtæ–‡ä»¶ç²˜è´´å³è½¬æ¢ï¼Œå®‰å…¨ä¸å·æºã€‚">
  <meta name="keywords" content="txtè½¬m3u,txtè½¬æ¢,m3uç”Ÿæˆ,LIVE">
<style>
    :root {
      --primary-color: #4a6fa5;
      --secondary-color: #6b8cae;
      --accent-color: #ff7e5f;
      --light-color: #f8f9fa;
      --dark-color: #343a40;
      --success-color: #28a745;
      --info-color: #17a2b8;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      margin: 0;
      padding: 0;
      color: var(--dark-color);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }
    
    h2 {
      color: var(--primary-color);
      margin: 10px 0;
      text-align: center;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    h3 {
      color: var(--secondary-color);
      margin-top: 0;
      margin-bottom: 15px;
      font-weight: 500;
    }
    
    .content-wrapper {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .panel-container {
      display: flex;
      gap: 30px;
    }
    
    .panel {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      position: relative; /* å…è®¸åœ¨é¢æ¿å†…å®šä½å†…å®¹ */
    }
    
    .panel:hover {
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
    }
    
    .panel-description {
      color: #6c757d;
      font-size: 14px;
      margin-bottom: 15px;
    }
    
    textarea {
      width: 96%;
      height: 250px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      resize: none;
      transition: border 0.3s;
      background-color: #fafafa;
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
    }
    
    .button-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin: 25px 0;
    }
    
    button {
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:nth-child(1) { background-color: var(--success-color); color: white; }
    button:nth-child(2) { background-color: var(--info-color); color: white; }
    button:nth-child(3) { background-color: var(--primary-color); color: white; }
    button:nth-child(4) { background-color: var(--secondary-color); color: white; }
    button:nth-child(5) { background-color: var(--warning-color); color: var(--dark-color); }
    button:nth-child(6) { background-color: var(--accent-color); color: white; }
    button:nth-child(7) { background-color: var(--danger-color); color: white; }
    
    #outputContainer {
      position: relative;
    }

    #result {
      position: absolute;
      top: -10px;
      right: 20px;
      padding: 12px;
      font-size: 12px;
      white-space: pre-wrap;
      max-width: 300px;
      min-width: 200px;
      color: #6c757d;
    }
    
    .footer {
      text-align: center;
      margin-top: 0px;
      color: #6c757d;
      font-size: 12px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1200px) {
      .panel-container {
        flex-direction: column;
        gap: 20px;
      }
      
      textarea {
        height: 300px;
      }
    }
    
    @media (max-width: 768px) {
      .button-container {
        flex-direction: column;
        align-items: center;
      }
      
      button {
        width: 100%;
        max-width: 300px;
        justify-content: center;
      }
    }

    /* è½»æç¤ºæ¡†ç¾åŒ–æ ·å¼ */
    #notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #4a6fa5 0%, #6b8cae 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-width: 80%;
      text-align: center;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* æ˜¾ç¤ºçŠ¶æ€ */
    #notification.show {
      opacity: 1;
      visibility: visible;
      top: 30px;
    }

    /* æˆåŠŸæç¤º */
    #notification.success {
      background: linear-gradient(135deg, #28a745 0%, #5cb85c 100%);
    }

    /* é”™è¯¯æç¤º */
    #notification.error {
      background: linear-gradient(135deg, #dc3545 0%, #d9534f 100%);
    }

    /* è­¦å‘Šæç¤º */
    #notification.warning {
      background: linear-gradient(135deg, #ffc107 0%, #f0ad4e 100%);
      color: #343a40;
    }

    /* ä¿¡æ¯æç¤º */
    #notification.info {
      background: linear-gradient(135deg, #17a2b8 0%, #5bc0de 100%);
    }

    /* æ·»åŠ å°å›¾æ ‡ */
    #notification::before {
      content: "";
      display: inline-block;
      width: 18px;
      height: 18px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    #notification.success::before {
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'><path d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/></svg>");
    }

    #notification.error::before {
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'><path d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/></svg>");
    }

    #notification.warning::before {
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23343a40'><path d='M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z'/></svg>");
    }

    #notification.info::before {
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z'/></svg>");
    }

</style>

<script>
window.onload = function() {
  var textarea = document.getElementById('inputText');
  textarea.setAttribute('placeholder', '1ã€æ”¯æŒTXTåˆ—è¡¨å’ŒM3Uåˆ—è¡¨äº’è½¬\n\n2ã€å¤åˆ¶é€šç”¨txtåˆ—è¡¨æˆ–è€…M3Uåˆ—è¡¨ç²˜è´´è‡³æ­¤è¿›è¡ŒTXTå’ŒM3Uäº’è½¬\n\n3ã€å¯Ctrl+Aå…¨é€‰tonkiang.usæœç´¢ç»“æœ,Ctrl+Cå¤åˆ¶ç»“æœç²˜è´´è‡³æ­¤æå–æ’­æ”¾åˆ—è¡¨å’Œç»„æ’­ID');
}
</script>

<body>
   <div id="notification"></div>
  <div class="container">
    <div class="content-wrapper">
      <h2>TXTå’ŒM3Uäº’è½¬å·¥å…·</h2>
      <h2 style="color: var(--accent-color); margin-top: -30px; font-size: 18px;">æ”¯æŒåˆå¹¶ç›¸åŒèŠ‚ç›® | ç”Ÿæˆæ’­æ”¾åˆ—è¡¨ | æå–ç»„æ’­ID</h2>

      <div class="panel-container">
        <div class="panel" id="inputContainer">
          <h3>è¾“å…¥å†…å®¹</h3>
          <p class="panel-description">å¯å¤åˆ¶tonkiang.usæœç´¢ç»“æœæˆ–è€…TXTã€M3Uæ’­æ”¾åˆ—è¡¨è¿›è¡Œè½¬æ¢</p>
          <textarea id="inputText" rows="20"></textarea>
        </div>

        <div class="panel" id="outputContainer">
          <h3>è½¬æ¢ç»“æœ</h3>
          <p class="panel-description">è½¬æ¢åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
          <textarea id="outputText" rows="20"></textarea>
          <pre id="result"></pre>
        </div>
      </div>

      <div class="button-container">
        <button onclick="convertText()">ğŸ“‹ M3Uè½¬æ¢TXT</button>
        <button onclick="getMulticast()">ğŸ” è·å–ç»„æ’­ID</button>
        <button onclick="convertToM3U()">ğŸ”„ TXTè½¬æ¢M3U</button>
        <button onclick="convertToM3U2()">âœ¨ TXTè½¬æ¢M3U(åˆå¹¶èŠ‚ç›®)</button>   
        <button onclick="copyText()">ğŸ“ å¤åˆ¶ç»“æœ</button>
        <button onclick="saveAsM3U()">ğŸ’¾ ä¿å­˜ç»“æœ</button>
        <button onclick="clearScreen()">ğŸ§¹ æ¸…é™¤å±å¹•</button>
      </div>
      
      <div class="footer">
        <div>Â© 2023 TXT/M3Uè½¬æ¢å·¥å…· | è®¾è®¡ä¼˜åŒ–ç‰ˆ</div>
        <div id="busuanzi_container_page_pv">
          æœ¬é¡µé¢æ€»è®¿é—®é‡ <span id="vercount_value_site_uv" style="font-weight: bold; color: var(--primary-color);"></span> æ¬¡
        </div>
      </div>
    </div>
  </div>
</body>



<script>

const gtChannels = ['å¤©æ˜ ', 'ç¾äºš', 'æ¾³è§†', 'VIUTV', 'æ— çº¿æ–°é—»', 'HOY', 'NOW', 'å°æ¹¾', 'é¦™æ¸¯', 'å‡¤å‡°', 'ç¿¡ç¿ ', 'æ˜ç ', 'TVB', 'ANIMAX', 'AXN', 'Arirang', 'BBC', 'Bloomberg', 'CARTOONITO', 'CBeebies',
    'CINEMAX', 'CNBC', 'CNN', 'CNå¡é€š', 'CatchPlay', 'CinemaWorld', 'DAZN', 'DMAX', 'DWTV', 'Discovery', 'DreamWorks',
    'ETtoday', 'EVE', 'FRANCE', 'FashionTV', 'Food', 'Global', 'HBO', 'HITS', 'INULTRA', 'JET', 'LOVE_NATURE', 'LUXE',
    'Lifetime', 'MOMO', 'MTV', 'NHK', 'Nick', 'Pet_Club_TV', 'ROCK', 'TLC', 'TV5', 'TVBS', 'TaiwanPlus', 'TechStorm',
    'Travel', 'Warner_TV', 'Zé¢‘é“', 'amc', 'rollor', 'tvN', 'ä¸‰åœ£ç”µè§†', 'ä¸‰ç«‹', 'ä¸œæ£®', 'ä¸œé£å«è§†', 'ä¸­å¤©', 'ä¸­è§†',
    'ä¹è§†å°', 'äºšæ´²', 'äººé—´', 'ä½›å«', 'å…«å¤§', 'å…¬å…±ç”µè§†', 'å…¬è§†', 'å† å†›', 'åŠ¨ç‰©æ˜Ÿçƒ', 'åæ–¹æ³•ç•Œ', 'åŠå²›', 'åè‰º',
    'åè—', 'åè§†', 'åšæ–¯', 'å†å²', 'åŸä½æ°‘', 'åŒå­å«è§†', 'å¤å…¸éŸ³ä¹', 'å°æ¹¾', 'å°è§†', 'å›½å…´', 'å£¹ç”µè§†', 'å¤§çˆ±',
    'å¤©ç¾ä¸½ç”µè§†', 'å¤©è‰¯ç»¼åˆ', 'å¥½æ¶ˆæ¯', 'å¥½è±å', 'å®¢å®¶ç”µè§†', 'å¯Œç«‹', 'å°¼å…‹å„¿ç«¥', 'å±…å®¶', 'å¹´ä»£', 'å¹¸ç¦ç©ºé—´', 'æ–°å¤©åœ°æ°‘ä¿—',
    'æ™ºæ—ä½“è‚²', 'æ¢…è¿ªå¥‡è‰ºæœ¯', 'æ¬§æ´²', 'æ­£å¾·', 'æ°‘è§†', 'æ³•å›½TV5', 'çˆ±å°”è¾¾', 'ç‹¼è°·è‚²ä¹', 'ç¯å®‡', 'ç”Ÿå‘½', 'ç•ªè–¯', 'çº¬æ¥',
    'ç½ªæ¡ˆ', 'è¯šå¿ƒç”µè§†', 'è¶…è§†', 'è¾¾æ–‡è¥¿', 'è¿é€šè´¢ç»', 'é•œç”µè§†', 'éœ¹é›³', 'é–å¤©', 'é–æ´‹å¡', 'éå‡¡', 'éŸ©å›½å¨±ä¹', 'é«˜ç‚¹',
    'é¾™ç¥¥'
];

  function convertText() { //æ•´ç†TXTåˆ—è¡¨
    outputText = checkText(document.getElementById('inputText').value);    
        if (outputText === '') {
        showNotification("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†", 'warning');
        // alert("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†");
        return;
        }
    let channels = outputText.split('\n');
    let groupedChannels = countGroups(channels);
    let resultText = "";
    groupedChannels.forEach(group => {
      resultText += ` ${group[0]}, èŠ‚ç›®æ•°ï¼š ${group[2]}, æ•°é‡ï¼š ${group[1]} \n`;
    });    
    document.getElementById('result').textContent = resultText;
    updateResultDisplay();
    document.getElementById('outputText').value = outputText;
    showNotification("è½¬æ¢æˆåŠŸï¼", 'success');
  }

  function getMulticast() { // è·å–ç»„æ’­ID
        if (document.getElementById('inputText').value === '') {
        showNotification("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†", 'warning');
        // alert("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†");
    return;
        }    
    let lines = checkText(document.getElementById('inputText').value).split('\n');
    let result = [];
    for (let line of lines) {
      let parts = line.split(',');
      if (parts.length > 1) {
        let url = parts[1];
        let multicastAddr = getMulticastAddr(url);
        if (multicastAddr) {
          result.push(parts[0] + ',' + 'rtp://' + multicastAddr);
        }else {
                result.push("invalidID");
        }
      }
    }
    let newLines = result.filter(line =>!line.includes('invalidID'));
      if (newLines.length === 0) {
        output = 'æ— ç»„æ’­ID';
      } else {
        output = groupToText(newLines.join("\n"));
      }
    let channels = output.split('\n');
    let groupedChannels = countGroups(channels);
    let resultText = "";
    groupedChannels.forEach(group => {
      resultText += `${group[0]}, èŠ‚ç›®æ•°ï¼š ${group[2]}, æ•°é‡ï¼š ${group[1]} \n`;
    });    
    document.getElementById('result').textContent = resultText;
    updateResultDisplay(); 
    document.getElementById('outputText').value = output;
    showNotification("è·å–æˆåŠŸï¼", 'success');
  }

  function convertToM3U() {  //è½¬æ¢M3U
    let inputText = document.getElementById('inputText').value;
        if (inputText === '') {
        showNotification("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†", 'warning');
        // alert("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†");
        return;
        }
    let channels = checkText(inputText).split('\n');
    let groupedChannels = countGroups(channels);
    let resultText = "";
    groupedChannels.forEach(group => {
      resultText += ` ${group[0]}, èŠ‚ç›®æ•°ï¼š ${group[2]}, æ•°é‡ï¼š ${group[1]} \n`;
    });    
    document.getElementById('result').textContent = resultText;
    updateResultDisplay();
    document.getElementById('outputText').value = textToM3U(checkText(inputText));
    showNotification("è½¬æ¢æˆåŠŸï¼", 'success');
  }

  function convertToM3U2() { //è½¬æ¢M3Uåˆå¹¶èŠ‚ç›®
    let inputText = document.getElementById('inputText').value;
        if (inputText === '') {
        showNotification("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†", 'warning');
        // alert("è¾“å…¥æ¡†ä¸ºç©ºï¼Œè¯·å°†æœç´¢ç»“æœæˆ–è€… txt åˆ—è¡¨ç²˜è´´åˆ°è¾“å…¥æ¡†");
        return;
        }
    let channels = checkText(inputText).split('\n');
    let groupedChannels = countGroups(channels);
    let resultText = "";
    groupedChannels.forEach(group => {
      resultText += ` ${group[0]}, èŠ‚ç›®æ•°ï¼š ${group[2]}, æ•°é‡ï¼š ${group[1]} \n`;
    });    
    document.getElementById('result').textContent = resultText;
    updateResultDisplay();
    document.getElementById('outputText').value = textToM3U(mergeUrls(checkText(inputText)));
    showNotification("è½¬æ¢æˆåŠŸï¼", 'success');
  }

  function textToM3U(text) {
    const epg = "https://live.fanmingming.cn/e.xml";
    const logoPath = "https://epg.v1.mk/logo/";
    let textlist = text.split('\n');
    let lines = textlist.filter(line => line.trim() !== '').map(line => line.trim());
    let listOutput = ['#EXTM3U x-tvg-url="' + epg + '"'];
    lines.forEach(line => {
      if (line.includes('#genre#')) {
        group = line.split(',')[0];
        return;
      }
      if (line.split(',').length === 2) {
        let [name, url] = line.split(',');
        listOutput.push('#EXTINF:-1 tvg-name="' + name + '" tvg-logo="' + logoPath + name + '.png" group-title="' + group + '",' + name + '\n' + url);
      }
    });
        return listOutput.join('\n');
  }

  function m3uToTxt(text) {
    let txtChs = [];
    let name = "";
    let url = "";
    let channels = text.split("\n");
    for (let channel of channels) {
      channel = channel.trim();
      // æ£€æŸ¥æ˜¯å¦ä»¥ #EXTINF å¼€å¤´
      if (channel.toUpperCase().startsWith("#EXTINF")) {
        // å¦‚æœæœ‰é€—å·ï¼Œå°†é€—å·åçš„éƒ¨åˆ†èµ‹å€¼ç»™ name
        if (channel.includes(",")) {
          name = channel.substring(channel.lastIndexOf(",") + 1).trim();
        }
      } else {
        // æ£€æŸ¥æ˜¯å¦åŒ…å« #
        if (channel.includes("#")) {
          // å°† channel æŒ‰ # åˆ†éš”ï¼Œå°†æ¯ä¸ªéƒ¨åˆ†èµ‹å€¼ç»™ url
          let urlParts = channel.split("#");
          for (let item of urlParts) {
            txtChs.push(`${name},${item.trim()}`);
          }
        } else {
          // æ²¡æœ‰ #ï¼Œç›´æ¥å°† channel èµ‹å€¼ç»™ url
          url = channel;
          txtChs.push(`${name},${url}`);
        }
      }
    }
    let outTextChs = [];
    for (let item of txtChs) {
      if (item.split(",").length === 2 && item.includes(",") && item.split(",")[0]!= "" && item.split(",")[1]!= "") {
        outTextChs.push(item);
      }
    }
    let outText = outTextChs.join("\n");
    let outputText = groupToText(outText)
    return outputText;
  }

  function processText(text) {
    let inputText = text.replace(/\[copy to clip\]/g, 'copy to clip').replace(/[\t ]/g, '').replace(/(\n)copytoclip(\n)/g, ',');
    let outText = groupToText(inputText);
    return outText;
  }

  function checkText(text) {
    if (text.includes("copy to clip")) {
      return processText(text);
    } else if (text.toUpperCase().includes("#EXTINF")){
      return m3uToTxt(text);
    } else {
      return originalText(text);
    }
  }

  function originalText(text) {
        let channels = text.split('\n').filter(function (line) {
            return line.trim()!== '' &&!line.includes('#genre#');
        });
    let inputText = channels.join("\n");
    return groupToText(inputText);
  }

  function countGroups(channels) {
    let result = [];
    let currentGroup = null;
    let uniqueItems = new Set();
    let count = 0;
    let programCount = 0;

    channels.forEach(item => {
      if (item.includes('#genre#')) {
        if (currentGroup !== null) {          
        result.push([currentGroup, count, programCount]);
        }
        currentGroup = item.split(',')[0];
        count = 0;
        programCount = 0;
      } else {
        count += 1;
        let itemKey = item.split(',')[0];
        if (!uniqueItems.has(itemKey)) {
          uniqueItems.add(itemKey);
          programCount += 1;
        }
      }
    });
    if (currentGroup !== null) {
      result.push([currentGroup, count-1, programCount-1]);
    }

    return result;
  }

  function mergeUrls(text) {
    const lines = text.split('\n');
    const channelMap = new Map();
    lines.forEach(line => {
      const parts = line.split(',');
      if (parts.length !== 2) {
        return;
      }
      const [channel, url] = parts;
      if (channelMap.has(channel)) {
            channelMap.get(channel).push(url);
      } else {
        channelMap.set(channel, [url]);
      }
    });
    const chresults = Array.from(channelMap, ([channel, urls]) => {
      return `${channel},${urls.join('#')}`;
    });
    const resultText = chresults.join('\n');
    return resultText;
  }

  function groupToText(inputText) {
    let ys = [];
    let ws = [];
    let df = [];
    let gt = [];
    let channels = inputText.split('\n').filter(line => line.includes(',') && line.split(',').length === 2 && !line.includes('#genre#'));
    channels = channels.map(channel => {
    let parts = channel.split(',');
    let newName = parts[0].toUpperCase().replace(/\s+/g, '').replace('é«˜æ¸…ç”µå½±', 'å½±è¿·ç”µå½±').replace('ä¸­å¤®', 'CCTV').replace('è¶…é«˜æ¸…', '').replace('é«˜æ¸…', '').replace('HD', '').replace('-CM-IPTV', '').replace('æ ‡æ¸…', '').replace('è¶…æ¸…', '').replace('ç”»ä¸­ç”»', '').replace('å•éŸ³è½¨', '').replace('-Tel', '').replace('-', '');
    return `${newName},${parts[1]}`;
    });

        for (let info of channels) {
            info = info.trim();
            if (['CCTV', 'CETV'].some(part => info.toUpperCase().includes(part))) {
                if (!info.toUpperCase().includes('5+')) {
                    try {
                        let [name, url] = info.split(',');
                        let match = name.match(/\w\w\w\w\d{1,2}|\w\w\w\w-\d{1,2}|\w\w\w\w-\w{1,4}|\w\w\w\w\w{1,8}|ä¸­å¤®\d{1,2}/i)[0];
                        name = match.replace(/-|é«˜æ¸…|HD|-CM-IPTV|-Tel|\s|æ ‡æ¸…|ä¸­å¤®|è¶…æ¸…|ç”»ä¸­ç”»|å•éŸ³è½¨/gi, '');
                        name = name.replace('ä¸­å¤®', 'CCTV').toUpperCase();
                        ys.push(`${name},${url}`);
                    } catch (e) {}
                } else {
                    let [name, url] = info.split(',');
                    ys.push(`CCTV5+,${url}`);
                }
            }else if (containsAnyChannel(info, gtChannels)) {
        let line = info.replace('+', '');
        gt.push(line);
      }else if (info.includes('å«è§†')) {
                let line = info.replace('+', '');
                ws.push(line);
            } else if (!info.includes('<br>') && info.trim()!== '' && info[0]!== ',' && info[0]!== '1') {
                let line = info.replace('+', '').replace('YD', '');
                df.push(line);
            }
        }
        var reschannels = "";
        if (ys.length > 0) {
            ys = [...new Set(ys)];
            reschannels += "\nå¤®è§†é¢‘é“,#genre#\n";
            ys.sort((a, b) => {
                let aPrefix = a.match(/[a-zA-Z]+/)[0];
                let bPrefix = b.match(/[a-zA-Z]+/)[0];
                if (aPrefix === bPrefix) {
                    let aNumber = parseInt(a.match(/\d+/)[0]);
                    let bNumber = parseInt(b.match(/\d+/)[0]);
                    return aNumber - bNumber;
                }
                return aPrefix.localeCompare(bPrefix);
            });
            for (var i = 0; i < ys.length; i++) {
                reschannels += ys[i] + "\n";
            }
        }
        if (gt.length > 0) {
            gt = [...new Set(gt)];
            reschannels += "\næ¸¯å°é¢‘é“,#genre#\n"
            for (var i = 0; i < gt.length; i++) {
                reschannels += gt[i] + "\n";
            }
        }
        if (ws.length > 0) {
            ws = [...new Set(ws)];
            reschannels += "\nå«è§†é¢‘é“,#genre#\n"
            for (var i = 0; i < ws.length; i++) {
                reschannels += ws[i] + "\n";
            }
        }
        if (df.length > 0) {
            df = [...new Set(df)];
            reschannels += "\nåœ°æ–¹é¢‘é“,#genre#\n";
            for (var i = 0; i < df.length; i++) {
                reschannels += df[i] + "\n";
            }
        } 
        reschannels = reschannels.replace(/^\s*\n/, '');   
        return reschannels;
  }

  function containsAnyChannel(info, channels) {
        let parts = info.split(',');
        let name = parts[0].trim();
    for (let channel of channels) {
      if (name.toUpperCase().includes(channel.toUpperCase())) {
        return true;
      }
    }
    return false;
  }

  function getMulticastAddr(url) {
    const regex = /(rtp\/|rtp:\/\/|udp\/|udp:\/\/)(.*)/;
    const match = url.match(regex);
    if (match) {
      return match[2];
    } else {
      return null;
    }
  }

  // å±•ç¤ºæç¤ºæ¡†
  function showNotification(message, type = '') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = ''; 
    notification.classList.add(type, 'show');
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }

  function copyText() {
    let outputText = document.getElementById("outputText");
    if (outputText && (outputText.value !== '' || outputText.innerText !== '')) {
        outputText.select();
        document.execCommand("copy");
        showNotification("è½¬æ¢ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿!", 'success');
    } else {
        showNotification("è¯·è½¬æ¢æ•°æ®åï¼Œå†æ‹·è´è½¬æ¢ç»“æœ", 'warning');
    }
  }
  
  function clearScreen() {
    document.getElementById('inputText').value = '';
    document.getElementById('outputText').value = '';
    document.getElementById('result').style.display = 'none';
    showNotification("æ¸…é™¤æˆåŠŸï¼", 'success');

  }

    function saveAsM3U() {
        const m3uContent = document.getElementById('outputText').value;
        if (m3uContent === '') {
        showNotification("è½¬æ¢ç»“æœä¸ºç©ºï¼Œè¯·è½¬æ¢æ•°æ®åå†è¿è¡Œä¿å­˜ç»“æœ", 'warning');
        return;
        }
        const blob = new Blob([m3uContent], { type: 'text/plain' });
        const a = document.createElement('a');
        const isM3U = m3uContent.includes('EXTM3U');
        a.download = isM3U ? 'playlist.m3u' : 'playlist.txt';
        a.href = URL.createObjectURL(blob);
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        const fileName = a.download;
        showNotification("ä¿å­˜æˆåŠŸï¼", 'success');
        //alert(`æ–‡ä»¶${fileName}å·²ä¿å­˜åˆ°é»˜è®¤ä¸‹è½½æ–‡ä»¶å¤¹`);
    }

  function updateResultDisplay() {
  var resultElement = document.getElementById('result');
  if (resultElement.innerHTML.trim() === '') {
    resultElement.style.display = 'none';
  } else {
    resultElement.style.display = 'block';
  }
}  

</script>
<script async src="https://vercount.one/js">
</script>  

</body>
</html>
